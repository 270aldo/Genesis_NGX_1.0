[tool:pytest]
# Test discovery
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
norecursedirs = scripts .git __pycache__ node_modules .pytest_cache .tox .venv venv

# Async configuration - using auto mode to avoid conflicts
asyncio_mode = auto

# Test markers - comprehensive list for better organization
markers =
    unit: Unit tests - fast, isolated tests without external dependencies
    integration: Integration tests - tests requiring full FastAPI app or external services
    agents: Agent-specific tests for the 11 specialized agents
    api: API endpoint tests
    a2a: Agent-to-Agent communication tests
    streaming: Streaming response and SSE tests
    slow: Slow tests that should run separately (>5 seconds)
    performance: Performance benchmark tests
    security: Security-related tests
    e2e: End-to-end tests covering full user flows
    beta_validation: Beta validation suite tests
    nexus_only: Tests specific to NEXUS-only mode
    mock: Tests using mocked external services
    real: Tests using real external services (Vertex AI, Supabase, etc)

# Command line options
addopts =
    --strict-markers
    --tb=short
    --verbose
    -ra
    --disable-warnings
    --ignore=scripts
    --ignore=docs

# Coverage configuration (when using pytest-cov)
# Use --cov flags in Makefile or CI for actual coverage

# Warnings configuration - reduce noise
filterwarnings =
    ignore::DeprecationWarning:google.*
    ignore::DeprecationWarning:opentelemetry.*
    ignore::DeprecationWarning:vertexai.*
    ignore::PendingDeprecationWarning
    ignore::ResourceWarning
    ignore::UserWarning:pydantic.*
    ignore::pytest.PytestUnraisableExceptionWarning

# Timeout configuration - prevent hanging tests
timeout = 30
timeout_method = thread
timeout_func_only = true

# Logging configuration
log_cli = false
log_cli_level = WARNING
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s - %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] %(name)s - %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# Minimum Python version requirement
minversion = 3.11

# Required plugins for proper test execution
required_plugins =
    pytest-asyncio>=0.21.0
    pytest-cov>=4.1.0
    pytest-timeout>=2.1.0
    pytest-mock>=3.11.1
